

https://ubuntuforums.org/showthread.php?t=2441797

проблема sda: add missing path

 
sudo nano /etc/multipath.conf

defaults {
    user_friendly_names yes
}
blacklist {
    devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
}

sudo service multipathd restart


https://help.ubuntu.ru/wiki/%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8


Настройка репозиториев
http://mirrors.ustc.edu.cn/help/ubuntu-old-releases.html


sudo nano /etc/apt/sources.list

^\ ищем http://ru.archive....
заменяем на http://mirrors.ustc.edu.cn/ubuntu-old-releases/ubuntu

sudo apt-get update


затем настройка прокси

sudo nano /etc/environment

http_proxy="http://192.168.0.55:3128/"
https_proxy="https://192.168.0.55:3128/"



sudo nano /etc/apt/apt.conf.d/10proxy

Acquire::http::proxy "http://192.168.0.55:3128/";
Acquire::https::proxy "https://192.168.0.55:3128/";
Acquire::ftp::proxy "http://192.168.0.55:3128/";
Acquire::::Proxy "true";




https://andreyex.ru/ubuntu/kak-ustanovit-ili-izmenit-chasovoj-poyas-na-ubuntu-20-04/

Как установить или изменить часовой пояс на Ubuntu 20.04

проверка
timedatectl

установка
sudo timedatectl set-timezone Europe/Moscow

https://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D1%81%D0%B5%D1%82%D1%8C/ntp




Установка PHP
sudo apt install apache2 php libapache2-mod-php php-mysql





Узнаем версию пакета в репозиториях Ubuntu
apt-cache search mysql | grep -i version

установка mysql 5.7 на 20.04 https://www.fosstechnix.com/how-to-install-mysql-5-7-on-ubuntu-20-04-lts/

Установка Tasksel

sudo apt-get update
sudo apt-get install tasksel


Установка LAMP

https://zen.yandex.ru/media/id/5bcde82f0c05e200aab52807/lampstack-server-linux--apache--mysql--php--phpmyadmin-na-ubuntu-18-ustanovka-s-pomosciu-tasksel-5cb570c88ac11800b3227943

mysql 8 правильная создание пользователя
https://www.fryaha.ru/mysql-8-correct-user-creation/







настройка mysql задание root пароля
sudo mysql_secure_installation



#добалвляем плагин аутентификации методом пароля в конфиг

sudo nano /etc/mysql/my.cnf

[mysqld]
default_authentication_plugin = mysql_native_password


sudo service mysql status

запуск обязательно из под ROOT #
sudo mysql -u root -p

show databases;

изменение пользователя рут под этот метод 
ALTER USER root@'localhost' IDENTIFIED WITH mysql_native_password BY 'ytgbgfq128';
FLUSH PRIVILEGES;


добавление другого супер пользователя 

CREATE USER 'webmaster'@'localhost' IDENTIFIED WITH mysql_native_password BY 'UbyDis7';
GRANT ALL PRIVILEGES ON * . * TO 'webmaster'@'localhost';
FLUSH PRIVILEGES;

exit







сделать index.php вместо index.html
cd /var/www/html
rm index.html
nano index.php
<?php phpinfo(); ?>

изменить ограничения в php.ini

sudo nano /etc/php/7.4/apache2/php.ini
^W
post_max_size 512
upload_max_filesize 512
max_execution_time 1200
max_input_time 1200
memory_limit = 512M

sudo service apache2 restart




https://stackoverflow.com/questions/49948350/phpmyadmin-on-mysql-8-0
Установка phpMyAdmin
sudo apt install phpmyadmin

sudo nano /etc/apache2/apache2.conf
довать строку 
Include /etc/phpmyadmin/apache.conf
sudo service apache2 restart


sudo dpkg-reconfigure phpmyadmin

Выключение
sudo shutdown -P now
Перезагрузка
sudo shutdown -r now

Изменить hostname
hostnamectl
sudo hostnamectl set-hostname new-ubuntu-server


установка самба
https://blog.listratenkov.com/install-samba-ubuntu-20-04/



тест скорости
curl http://kpmed.ru/video/VMESTE_YARCHE2020.mp4 --output 1.mp4
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  718M  100  718M    0     0  7714k      0  0:01:35  0:01:35 --:--:-- 8074k


монтирование samba-ресурса

установка apt-get install smbfs
mkdir /mnt/backup
smbmount //192.168.0.168/backup_kpmed.ru /mnt/backup -o user=cox,pass=NickB@rim0r,dom=kpmed,rw,uid=33,gid=100,dir_mode=0777,file_mode=0777,noperm

backup.sh
#полный Бэкап
cd /temp
tar -v --create --ignore-failed-read --one-file-system --preserve-permissions --recursion --preserve-order --sparse --totals --wildcards --verbose --gzip --file=./backup-`date '+%Y_%m_%d'`.tar /etc --exclude Backup


restore.sh
tar -xvf /temp/backup-2020_12_21.tar
tar -xvf /temp/backup-2020_12_21.tar --exclude="etc/ssh"
tar -xvf /temp/backup-2020_12_21.tar --exclude="etc/ssh" --exclude="etc/X11" --exclude="etc/*.conf"
tar -xvpf /mnt/backup/back-full-2021_01_01.tar --exclude-from="/ex-files"





boot/*
etc/fstab
etc/network/*
dev/*
tmp/*
run/*
mnt/*
home/Backup/*
proc/*
var/log/*
var/log/run/*
var/www/subdomain/doc/*




# mysql -u root -p Doclite < ../tmp/mysql-dump_Doclite_2021_01_16.sql



время

dpkg-reconfigure tzdata
(часовой пояс либо Europe/Moscow, либо GMT-3)

tzselect - выбор пояса

date # посмотреть системное время
date -R #формат rfc...
date -u #utc
date MMDDhhmmYYYY.ss - установить системное время
date 011818532021.20

hwclock -r посмотреть время в биос
hwclock -w установить время в биос из системного

еще можно поставит ntp

автозагрузка 
https://wiki.dieg.info/update-rc.d
$ runlevel
$ who -r


цвета в терминале

I just un-uncommented the line force_color_prompt=yes in the file ~/.bashrc


подключение удалённой системы ssh

apt-get install sshfs
sshfs webmaster@uslugi.kpmed.ru:/var/www  /mnt/uslugi

https://winitpro.ru/index.php/2021/10/28/kms-server-vlmcsd-na-linux-dlya-aktivacii-windows-office/

git config --global http.sslVerify false
git clone https://github.com/Wind4/vlmcsd



https://netplan.io/examples/


# This is the network config written by 'subiquity'
network:

#  ethernets:
#    ens33:
#      dhcp4: true
  version: 2
  ethernets:
    ens33: #Edit this line according to your network interface name you just saw.
      dhcp4: false
      dhcp6: false
      addresses:
        - 192.168.0.4/24
      routes:
        - to: default
          via: 192.168.0.11
      nameservers:
        addresses: [192.168.0.6,192.168.6.9]

netplan generate
netplan apply




KMS linux server
vlmcsd.ini
https://winitpro.ru/index.php/2021/10/28/kms-server-vlmcsd-na-linux-dlya-aktivacii-windows-office/
https://pikabu.ru/story/piratskie_budni_kms_ch1_5105161


Установка KMS сервера vlmcsd на Linux для активации Windows и Office
http://wind4.github.io/vlmcsd/



установка AD samba4 + bind9
https://wiki.astralinux.ru/pages/viewpage.action?pageId=27362929

sudo apt install bind9 dnsutils

named-checkconf — инструмент проверки синтаксиса файлов конфигурации;
named-checkzone — инструмент проверки файлов зон DNS;
rndc 		— инструмент управления службой DNS.
dig 		- инструмент для опроса DNS-серверов и проверки их реакции;
nslookup 	- инструмент для проверки преобразования имен в IP-адреса (далее в тексте используется термин "разрешение имён");
nsupdate 	- инструмент для динамического обновления записей DNS.


https://ixnfo.com/bind9-logging.html
По умолчанию логи Bind9 записываются в системный журнал /var/log/syslog и чтобы отделить их, выполним действия которые я укажу ниже.

sudo nano /etc/bind/named.conf

добавляем в конец

logging {
          channel "misc" {
                    file "/var/log/named/misc.log" versions 10 size 10m;
                    print-time YES;
                    print-severity YES;
                    print-category YES;
          };
  
          channel "query" {
                    file "/var/log/named/query.log" versions 10 size 10m;
                    print-time YES;
                    print-severity NO;
                    print-category NO;
          };
  
          channel "lame" {
                    file "/var/log/named/lamers.log" versions 1 size 5m;
                    print-time yes;
                    print-severity yes;
                    severity info;
          };
  
          category "default" { "misc"; };
          category "queries" { "query"; };
          category "lame-servers" { "lame"; };
  
};

Не забываем создать директорию и назначить права:

sudo mkdir /var/log/named/
sudo chown bind:bind /var/log/named/

Перезапустим Bind9 чтобы применить изменения:
sudo /etc/init.d/bind9 restart
systemctl restart named


Либо применим без перезапуска:
sudo rndc reconfig


отключение IPv6

ip addr show

sudo nano /etc/sysctl.conf
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1

перезагрузка конфигурации
sudo sysctl -p


подготовка к поднятию домена
sudo systemctl disable systemd-resolved
sudo systemctl stop systemd-resolved
rm /etc/resolv.conf
nano /etc/resolv.conf
search tin.home
nameserver 192.168.50.100


место на диске
df -h /

размер папок
du -hd 1





